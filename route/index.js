var express=require("express"),router=express.Router(),userCon=require("../dao/dbCon"),art_temp=require("art-template");require.extensions[".ejs"]=art_temp.extension;for(var side_test_data=[],i=0;i<20;i++)side_test_data.push("笔记"+(i+1));router.get("/home",function(s,e){s.session.islogin&&(e.locals.islogin=s.session.islogin),s.cookies.islogin&&(s.session.islogin=s.cookies.islogin),e.render("home",{title:"首页",user:e.locals.islogin,side_test_data:side_test_data}),console.log(side_test_data)}),router.get("/",function(s,e){s.cookies.islogin&&(s.session.islogin=s.cookies.islogin),s.session.islogin&&(e.locals.islogin=s.session.islogin),e.render("index",{title:"首页",user:e.locals.islogin,side_test_data:side_test_data})}),router.route("/login").get(function(s,e){s.session.islogin&&(e.locals.islogin=s.session.islogin),s.cookies.islogin&&(s.session.islogin=s.cookies.islogin),e.render("login",{title:"用户登录",user:e.locals.islogin})}).post(function(s,e){client=userCon.connect(),result=null,userCon.selectFun(client,s.body.username,function(i){void 0===i[0]?e.send("没有该用户"):i[0].password===s.body.password?(s.session.islogin=s.body.username,e.locals.islogin=s.session.islogin,e.cookie("islogin",e.locals.islogin,{maxAge:6e4}),e.redirect("/home")):e.redirect("/login")})}),router.get("/logout",function(s,e){e.clearCookie("islogin"),s.session.destroy(),e.redirect("/")}),router.route("/reg").get(function(s,e){e.render("reg",{title:"注册"})}).post(function(s,e){client=userCon.connect(),userCon.insertFun(client,s.body.username,s.body.password,function(i){if(i)throw i;i?e.redirect("/regMsg"):(s.session.islogin=s.body.username,e.locals.islogin=s.session.islogin,e.cookie("islogin",e.locals.islogin,{maxAge:6e4}),e.redirect("/regMsg"))})}),router.route("/regMsg").get(function(s,e){s.session.islogin&&(e.locals.islogin=s.session.islogin),s.cookies.islogin&&(s.session.islogin=s.cookies.islogin);e.render("reg_msg",{msg:"注册成功",user:e.locals.islogin})});var side_bar_temp=require("../views/sideBar.ejs"),side_bar_html=side_bar_temp({side_test_data:side_test_data});module.exports=router;